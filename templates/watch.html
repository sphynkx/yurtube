{% extends "base.html" %}
{% block content %}
<div class="player-wrapper">
  <div class="player-wrap" id="watch-player-wrap">
    <video id="watch-player" controls preload="metadata" style="width:100%;max-height:70vh" {% if poster_url %}poster="{{ poster_url }}"{% endif %}>
      <source src="/storage/{{ video['storage_path'] }}/original.webm" type="video/webm">
      Your browser does not support the video tag.
    </video>
    <div class="video-overlay" id="watch-overlay" title="Play/Pause">
      <img src="/static/img/YT_fav128.png" alt="Play">
    </div>
  </div>
</div>

<h2 class="watch-title">{{ video['title'] }}</h2>

<div class="video-info">
  <div class="author">
    <img class="mini-avatar" src="{{ video['author_avatar_url_small'] }}" alt="avatar"
         onerror="this.onerror=null;this.src='/static/img/avatar_default.svg';">
    {% if video['username'] %}
      <a href="/@{{ video['username'] }}">@{{ video['username'] }}</a>
    {% else %}
      <a href="/c/{{ video['channel_id'] }}">{{ video['channel_id'] }}</a>
    {% endif %}
  </div>
  <div class="counters">{{ video['views_count'] }} views</div>
  <div class="created-at">{{ video['created_at']|dt }}</div>
</div>

<p>{{ video['description'] }}</p>

{% if can_embed %}
<details style="margin-top:16px;">
  <summary>Embed</summary>
  <div style="margin-top:8px;">
    <textarea id="embed-code" readonly style="width:100%;height:100px;">{{ embed_code }}</textarea>
    <div style="margin-top:8px;">
      <button id="copy-embed">Copy to clipboard</button>
    </div>
  </div>
</details>
{% endif %}

<script>
(function(){
  var wrap = document.getElementById("watch-player-wrap");
  var video = document.getElementById("watch-player");
  var overlay = document.getElementById("watch-overlay");
  var copyBtn = document.getElementById("copy-embed");
  var code = document.getElementById("embed-code");

  if (overlay && video && wrap) {
    function sync() {
      if (video.paused) {
        wrap.classList.remove("playing");
      } else {
        wrap.classList.add("playing");
      }
    }
    overlay.addEventListener("click", function(){
      if (video.paused) { video.play(); } else { video.pause(); }
    });
    video.addEventListener("play", sync);
    video.addEventListener("pause", sync);
    video.addEventListener("ended", sync);
    sync();
  }

  if (copyBtn && code) {
    copyBtn.addEventListener("click", function(){
      try {
        code.select();
        document.execCommand("copy");
      } catch(e) {}
    });
  }
})();
</script>
{% endblock %}