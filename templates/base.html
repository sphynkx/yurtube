<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>YurTube</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/static/css/main.css" rel="stylesheet">
  <link href="/static/css/brand.css" rel="stylesheet">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ favicon_url|default('/static/img/YT_fav32.png') }}">
  <link rel="apple-touch-icon" href="{{ apple_touch_icon_url|default('/static/img/YT_fav128.png') }}">

  {# NOTE:
     Brython scripts moved to the end of <body> and loaded with 'defer'
     so the page never blocks if CDN is slow/unreachable.
     If you want to self-host Brython, place files under /static/vendor/brython/
     and switch the script src URLs accordingly (see bottom of body). #}
</head>
<body>
  <header class="site-header">
    <div class="logo">
      <a href="/" aria-label="YurTube home">
        <img class="brand-logo" src="{{ brand_logo_url|default('/static/img/YT_long.png') }}" alt="YurTube">
      </a>
    </div>
    <form class="search-form" action="/search" method="get">
      <input type="text" name="q" placeholder="Search" aria-label="Search">
    </form>
    <nav class="user-nav">
      {% if current_user %}
        <details class="user-menu">
          <summary>
            <img
              id="nav-avatar"
              src="/storage/users/{{ current_user['user_uid'] }}/avatar_small.png"
              alt="me"
              class="avatar"
              data-cache-bust="1"
              onerror="this.onerror=null;this.src='/static/img/avatar_default.svg';"
            >
          </summary>
          <ul>
            <li><a href="/account">Account</a></li>
            <li><a href="/manage">My videos</a></li>
            <li><a href="/subscriptions">My subscriptions</a></li>
            <li><a href="/history">My history</a></li>
            <li class="menu-sep"><hr></li>
            <li><a href="/upload">Upload</a></li>
            <li class="menu-sep"><hr></li>
            <li>
              <form action="/auth/logout" method="post" style="display:inline">
                <button type="submit">Logout</button>
              </form>
            </li>
          </ul>
        </details>
      {% else %}
        <a href="/auth/login">Login</a>
        <a href="/auth/register">Register</a>
      {% endif %}
    </nav>
  </header>

  <div class="layout">
    <aside class="sidebar">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/trending">Trending</a></li>
        <li><a href="/subscriptions">Subscriptions</a></li>
        <li><a href="/history">History</a></li>
      </ul>
    </aside>
    <main class="content">
      {% block content %}{% endblock %}
    </main>
  </div>

  {# Brython runtime and stdlib â€” deferred and at the end to avoid blocking render #}
  <script defer src="https://cdn.jsdelivr.net/npm/brython@3.13.0/brython.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/brython@3.13.0/brython_stdlib.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // Safely initialize Brython after DOM is parsed. If CDN fails, page still renders.
    window.addEventListener("DOMContentLoaded", function () {
      try {
        if (window.brython) { brython(); }
      } catch (e) {
        // Non-fatal: UI keeps working without Brython extras
        console && console.warn && console.warn("[init] Brython init skipped:", e);
      }
    });
  </script>

  {# If you prefer self-hosted Brython, place files under /static/vendor/brython/
     and use the lines below instead of the CDN ones:
     <script defer src="/static/vendor/brython/brython.min.js"></script>
     <script defer src="/static/vendor/brython/brython_stdlib.js"></script>
     <script>window.addEventListener("DOMContentLoaded",function(){try{if(window.brython){brython();}}catch(e){}});</script>
  #}
</body>
</html>