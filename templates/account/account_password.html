{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="/static/css/manage/account_layout.css">

<div class="manage-comments-layout">
  {% include "account/left.html" %}
  <main class="mc-main">
  <div style="max-width:560px;">
    <h2>Change password</h2>

    {% if errors and errors|length > 0 %}
      <div style="background:#ffe6e6;color:#900;padding:10px;border-radius:4px;margin:10px 0;">
        <ul style="margin:0 0 0 18px;">
          {% for e in errors %}
            <li>{{ e }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    {% if saved %}
      <div style="background:#e6ffea;color:#065f46;padding:10px;border-radius:4px;margin:10px 0;">
        Password has been updated.
      </div>
    {% endif %}

    {% if suggestions and suggestions|length > 0 and (not saved) %}
      <div style="background:#f2f7ff;color:#204b7b;padding:10px;border-radius:4px;margin:10px 0;">
        <div style="font-weight:600;margin-bottom:4px;">Suggestions (optional)</div>
        <ul style="margin:0 0 0 18px;">
          {% for s in suggestions %}
            <li>{{ s }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <style>
      .pw-field { position: relative; display: inline-flex; align-items: center; }
      .pw-input  { width: 20ch; max-width: 100%; padding-right: 28px; }
      .pw-eye {
        position: absolute;
        right: 4px;
        width: 24px;
        height: 24px;
        border: 0;
        padding: 0;
        background: transparent;
        cursor: pointer;
        opacity: 0.8;
      }
      .pw-eye:hover { opacity: 1; }
      .pw-eye::before {
        content: "";
        display: block;
        width: 100%;
        height: 100%;
        background-repeat: no-repeat;
        background-position: center;
        background-size: 20px 20px;
        background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-lineca[...]");
      }
    </style>

    <form action="/account/password?csrf_token={{ csrf_token or request.cookies.get('yt_csrf') or '' }}"
          method="post"
          style="display:flex;flex-direction:column;gap:12px;">
      <input type="hidden" name="csrf_token" value="{{ csrf_token or request.cookies.get('yt_csrf') or '' }}">
      <label>
        <div>Current password</div>
        <div class="pw-field">
          <input id="pw-current" class="pw-input" type="password" name="current_password" required autocomplete="current-password">
          <button type="button" class="pw-eye" data-target="pw-current" aria-label="Hold to show"></button>
        </div>
      </label>

      <label>
        <div>New password</div>
        <div class="pw-field">
          <input id="pw-new" class="pw-input" type="password" name="new_password" required autocomplete="new-password">
          <button type="button" class="pw-eye" data-target="pw-new" aria-label="Hold to show"></button>
        </div>
      </label>

      <label>
        <div>Confirm new password</div>
        <div class="pw-field">
          <input id="pw-confirm" class="pw-input" type="password" name="confirm_password" required autocomplete="new-password">
          <button type="button" class="pw-eye" data-target="pw-confirm" aria-label="Hold to show"></button>
        </div>
      </label>

      <div>
        <button type="submit">Change password</button>
      </div>
    </form>

    <p style="margin-top:10px;font-size:12px;color:#666;">
      Policy: â‰¥8 chars. zxcvbn min score: {{ min_score }} (available: {{ 'yes' if zxcvbn else 'no' }}). Suggestions do not block saving.
    </p>
  </div>

  <script>
  (function(){
    function bindEye(btn){
      var id = btn.getAttribute("data-target");
      var input = document.getElementById(id);
      if (!input) return;
      var show = function(){ try { input.setAttribute("type", "text"); } catch(e){} };
      var hide = function(){ try { input.setAttribute("type", "password"); } catch(e){} };
      btn.addEventListener("mousedown", function(e){ e.preventDefault(); show(); });
      btn.addEventListener("mouseup", hide);
      btn.addEventListener("mouseleave", hide);
      btn.addEventListener("touchstart", function(e){ e.preventDefault(); show(); }, {passive:false});
      btn.addEventListener("touchend", hide);
      input.addEventListener("blur", hide);
    }
    function initEyes(){
      var eyes = document.querySelectorAll(".pw-eye");
      for (var i=0;i<eyes.length;i++) bindEye(eyes[i]);
    }
    if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", initEyes);
    else initEyes();
  })();
  </script>
    </main>
</div>
{% endblock %}